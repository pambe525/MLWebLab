{% extends 'base.html' %}
{% block home_content %}
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
          integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
          crossorigin="anonymous">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
          integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
          crossorigin="anonymous">
  </script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
          integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
          crossorigin="anonymous">
  </script>
  {% load static %}

  <div class="row mx-1">
    <!-- File input form  -->
    <form class="my-3" id="datafile_form" action={% url 'index' %} method="POST">
        {% csrf_token %}
        <div class="input-group">
            <div class="input-prepend" >
                <span class="input-group-text pt-1 pb-0 bg-white">{{ datafile_form.data_file.label_tag }}</span>
            </div>
            <div class="input-group-append">{{ datafile_form.data_file }}</div>
            <div class="input-group-append">
                <button type="submit" name="select_btn" class="btn" {% if select_btn_disabled %} disabled {% endif %}>
                    Select
                </button>
                <button type="submit" name="change_btn" class="btn" {% if change_btn_disabled %} disabled {% endif %}>
                    Change Data File
                </button>
            </div>
        </div>
    </form>
    <!-- /File input form  -->
    <!-- Message box -->
    <div id="msg_box" class="message-box row mx-3">
        <span id="msg_text" class="col">{{  error_message }}</span>
        <button id="msg_box_close" type="button" class="close col-*">&times;</button>
    </div>
    <!-- /Message box -->
    </div>

<!-- Content Area -->
<div id="home_container" class="{% if not container_visible %}invisible{% endif %} row container-fluid">
    <form id="sidebar_form" action={% url 'index' %} method="POST">
        {% csrf_token %}
        <div name="data_file_name">{{ control_form.data_file_name }}</div>
        <div class="card border-dark mt-1">
	        <div class="card-header bg-dark text-center h5 text-white">
	   	        <i class="fa fa-cog"></i><span class="px-2">CONTROL PANEL</span>
	        </div>
            <div class="row mx-0">
                <h6 class="card-title">Task:</h6>
                <span class="card-label static-field col">Supervised Learning</span>
            </div>
           <div class="row mx-0">
                <h6 class="card-title">Type:</h6>
                <span class="card-label static-field col">Regression</span>
            </div>
            <h6 class="card-title">Target Feature:</h6>
            <div class="card-label static-field" name="target_feature">{{ target_feature }}</div>
 	        <div class="row mx-0">
	            <h6 class="card-title col-*">Base Features:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h6>
	            <span class="card-label static-field col" name="base_features">{{  base_features }}</span>
	        </div>
            <hr>
	        <div class="row mx-0">
      	        <h6 class="card-title col-*">Training Set Ratio:&nbsp;&nbsp;</h6>
                <span>{{ control_form.training_ratio }}</span>
	        </div>
 	        <div class="row mx-0">
	            <h6 class="card-title col-*">Training Samples:&nbsp;&nbsp;&nbsp;</h6>
	            <span class="card-label static-field col" name="training_rows">{{ training_rows }}</span>
	        </div>
            <div class="row mx-0">
	            <h6 class="card-title col-*">Validation Samples: </h6>
	            <span class="card-label static-field col" name="validation_rows">{{ validation_rows }}</span>
	        </div>
            <hr>
            <h6 class="card-title">Algorithm/Method:</h6>
            <div style="width:220px">{{  control_form.training_method }}</div>
            <hr>
            <button type="submit" class="btn m-2" name="train_btn">Train</button>
        </div>
    </form>

    <nav class="mx-4 my-2">
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <a class="nav-item nav-link {% if active_tab == "explore" %}active{% endif %}"
            id="nav-explore-tab" data-toggle="tab" href="#nav-explore" role="tab">
            <i class="fa fa-database mx-1"></i>Explore Data</a>
        <a class="nav-item nav-link {% if active_tab == "validate" %}active{% endif %}
            {% if validation_disabled %} disabled {% endif %}"
            id="nav-validate-tab" data-toggle="tab" href="#nav-validate" role="tab">
            <i class="fa fa-clipboard-check mx-1"></i>Validate</a>
      </div>
    <div class="tab-content" id="nav-tabContent">
      <div class="tab-pane show {% if active_tab == "explore" %}active{% endif %}" id="nav-explore" role="tabpanel">
          {% include "explore.html" %}
      </div>
      <div class="tab-pane {% if active_tab == "validate" %}active{% endif %}" id="nav-validate" role="tabpanel">
          {% include "validate.html" %}
      </div>
    </div>
    </nav>
</div>
<!-- /Content Area -->
{% endblock home_content %}

{% block javascript %}
      <script type="text/javascript">
          $(document).ready(function(){
              let errorMessage = "{{ error_message }}";
              if (errorMessage != "None") $('#msg_box').show();
              else $("#msg_box").hide();
              $("#glass_pane").hide();

              $("#msg_box_close").on('click', function() {
                  $("#msg_box").hide();
              });
              $("#datafile_form").on('submit', function() {
                  if ( $(document.activeElement).attr('name') === "train_btn") $("#glass_pane").show();
              });
              $("#sidebar_form").on('submit', function(e) {
                  if ( $(document.activeElement).attr('name') === "train_btn") $("#glass_pane").show();
              });
          })
      </script>

{% endblock javascript %}